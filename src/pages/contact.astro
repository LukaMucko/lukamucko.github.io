---
import Layout from "../layouts/Layout.astro";
---

<Layout>
    <main id="contact-container">
        <button id="reveal-email" class="reveal-btn" type="button">
            Email Me
        </button>
        <div id="email-box" class="hidden" aria-live="polite">
            <h1 id="email-text">reveal in progress</h1>
            <a href="/" class="back-link">‚Üê Back</a>
        </div>
    </main>
</Layout>

<style>
    main {
        position: relative;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
        background: var(--bg-color);
    }

    .reveal-btn {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-family: "Courier New", Courier, monospace;
        background: var(--bg-color);
        border: 2px solid var(--text-color);
        padding: 0.8rem 2rem;
        font-size: 1.5rem;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 6px 6px 0px var(--shadow-color);
        white-space: nowrap;
        z-index: 1;
        color: inherit;
        transition:
            transform 0.1s,
            box-shadow 0.1s;
    }
    .reveal-btn:active {
        transform: translate(calc(-50% + 2px), calc(-50% + 2px));
        box-shadow: 2px 2px 0px var(--shadow-color);
    }

    #email-box {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--bg-color);
        border: 5px solid var(--text-color);
        padding: 4rem;
        box-shadow: 20px 20px 0px var(--shadow-color);
        text-align: center;
        z-index: 100;
    }

    #email-box h1 {
        font-size: 4rem;
        margin: 0;
        word-break: break-all;
    }

    .back-link {
        display: inline-block;
        margin-top: 2rem;
        color: var(--text-color);
        text-decoration: none;
        font-weight: bold;
        border-bottom: 2px solid var(--text-color);
    }

    .hidden {
        display: none !important;
    }

    @media (max-width: 768px) {
        #email-box {
            padding: 2rem;
            width: 80%;
        }
        #email-box h1 {
            font-size: 2rem;
        }
    }
</style>

<script>
    const emailBox = document.getElementById("email-box");
    const emailText = document.getElementById("email-text");
    const revealButton = document.getElementById("reveal-email");
    const encodedEmail = "BxASCksUHgYSBCUeBgQQB0saBAg=";
    const key = "key";

    const decodeEmail = (encoded, secret) => {
        const bytes = Uint8Array.from(atob(encoded), (c) => c.charCodeAt(0));
        let result = "";
        for (let i = 0; i < bytes.length; i++) {
            result += String.fromCharCode(
                bytes[i] ^ secret.charCodeAt(i % secret.length),
            );
        }
        return result;
    };

    const revealEmail = () => {
        if (!emailBox || !emailText) return;
        const decoded = decodeEmail(encodedEmail, key);
        emailText.textContent = decoded;
        emailBox.classList.remove("hidden");
        if (revealButton) {
            revealButton.classList.add("hidden");
        }
    };

    if (revealButton) {
        revealButton.addEventListener("click", revealEmail);
    }
</script>
